/*!
 * insicht - version 0.7.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2020 Steve Ottoz
 */
var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};const defaults={container:document.documentElement,selector:'.insicht',visibleClass:'sichtbar',stagger:100,threshold:0,autoRefresh:!1,autoReset:!1,autoRemove:!1,init:()=>{},done:()=>{}};export default class InSicht{constructor(a={}){this.options=_extends({},defaults,a),this.init()}init(){return this.intersection=new IntersectionObserver(this.onIntersection.bind(this),{threshold:this.options.threshold}),this.mutation=new MutationObserver(this.onMutation.bind(this)),this.refreshTimeout=null,this._items=[],this.connect(),this.refresh(),this}refresh(){return clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(()=>{this.items=[].slice.call(this.options.container.querySelectorAll(this.options.selector),0)},100),this}order(c,a){return this._items.indexOf(c.target)-this._items.indexOf(a.target)}connect(){return this.disconnect(),this._items.forEach((a)=>{this.options.init instanceof Function&&this.options.init.apply(this,[a,this]),this.intersection.observe(a)}),this.options.autoRefresh&&this.mutation.observe(this.options.container,{subtree:!0,attributes:!0,childList:!0}),this}disconnect(){return this.intersection.disconnect(),this.mutation.disconnect(),this}onIntersection(a){let b=0;for(let c in a=[].slice.call(a,0),a.sort(this.order.bind(this)),a){const d=a[c].target,e=a[c].isIntersecting;e&&!d.classList.contains(this.options.visibleClass)?(b=0===c?0:b+(+d.dataset.stagger||this.options.stagger),d.style.transitionDelay=`${b}ms`,d.classList.add(this.options.visibleClass),this.options.done instanceof Function&&this.options.done.apply(this,[d,this]),this.options.autoRemove&&this.remove(d)):!e&&this.options.autoReset&&d.classList.contains(this.options.visibleClass)&&(d.style.transitionDelay='',d.classList.remove(this.options.visibleClass))}}onMutation(a){a=[].slice.call(a,0),a.forEach((a)=>{let b=!1;[].slice.call(a.addedNodes,0).forEach((a)=>{a.nodeType===Node.ELEMENT_NODE&&(this.matches(a,this.options.selector)||a.querySelectorAll(this.options.selector).length)&&(b=!0)}),b&&this.refresh()})}matches(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)}get items(){return this._items}set items(a){Array.isArray(a)&&(this._items=a,this.connect())}remove(a){if(!this.options.autoRefresh&&a&&a.nodeType===Node.ELEMENT_NODE){let b=this._items.indexOf(a);-1<b&&this._items.splice(b,1),this.intersection.unobserve(a)}return this}reset(){return this._items.forEach((a)=>{a.classList.remove(this.options.visibleClass)}),this}destroy(){return this.disconnect(),this}}