/*!
 * insicht - version 0.3.1
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2018 Steve Ottoz
 */
(function(a,b){if('function'==typeof define&&define.amd)define(['module','exports'],b);else if('undefined'!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.InSicht=c.exports}})(this,function(a,b){'use strict';function c(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var d='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={container:document.documentElement,selector:'.insicht',visibleClass:'sichtbar',stagger:100,threshold:0,autoRefresh:!1,autoReset:!1,autoRemove:!1,init:function(){},done:function(){}},g=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.options=Object.assign({},f,b),this.init()}return e(a,[{key:'init',value:function(){return this.intersection=new IntersectionObserver(this.onIntersection.bind(this),{threshold:this.options.threshold}),this.mutation=new MutationObserver(this.onMutation.bind(this)),this.refreshTimeout=null,this._items=[],this.connect(),this.refresh(),this}},{key:'refresh',value:function(){var a=this;return clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){a.items=[].slice.call(a.options.container.querySelectorAll(a.options.selector),0)},100),this}},{key:'order',value:function(c,a){return this._items.indexOf(c.target)-this._items.indexOf(a.target)}},{key:'connect',value:function(){this.disconnect();var a,b=!0,c=!1;try{for(var e,f,g=this._items[Symbol.iterator]();!(b=(e=g.next()).done);b=!0)f=e.value,/^f/.test(d(this.options.init))&&this.options.init.apply(this,[f,this]),this.intersection.observe(f)}catch(b){c=!0,a=b}finally{try{!b&&g.return&&g.return()}finally{if(c)throw a}}return this.options.autoRefresh&&this.mutation.observe(this.options.container,{subtree:!0,attributes:!0,childList:!0}),this}},{key:'disconnect',value:function(){return this.intersection.disconnect(),this.mutation.disconnect(),this}},{key:'onIntersection',value:function(a){var b=0;for(var c in a=[].slice.call(a,0),a.sort(this.order.bind(this)),a){var e=a[c].target,f=Math.min(a[c].intersectionRatio,1),g=0<f;g&&!e.classList.contains(this.options.visibleClass)?(b=0===c?0:b+(+e.dataset.stagger||this.options.stagger),e.style.transitionDelay=b+'ms',e.classList.add(this.options.visibleClass),/^f/.test(d(this.options.done))&&this.options.done.apply(this,[e,this]),this.options.autoRemove&&this.remove(e)):!g&&this.options.autoReset&&e.classList.contains(this.options.visibleClass)&&(e.style.transitionDelay='',e.classList.remove(this.options.visibleClass))}}},{key:'onMutation',value:function(a){a=[].slice.call(a,0);var b,c=!0,d=!1;try{for(var e,f=a[Symbol.iterator]();!(c=(e=f.next()).done);c=!0){var g=e.value,h=!1,i=!0,j=!1,k=void 0;try{for(var l,m,n=[].slice.call(g.addedNodes,0)[Symbol.iterator]();!(i=(l=n.next()).done);i=!0)m=l.value,m.nodeType===Node.ELEMENT_NODE&&(this.matches(m,this.options.selector)||m.querySelectorAll(this.options.selector).length)&&(h=!0)}catch(a){j=!0,k=a}finally{try{!i&&n.return&&n.return()}finally{if(j)throw k}}h&&this.refresh()}}catch(a){d=!0,b=a}finally{try{!c&&f.return&&f.return()}finally{if(d)throw b}}}},{key:'matches',value:function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)}},{key:'remove',value:function(a){if(!this.options.autoRefresh&&a&&a.nodeType===Node.ELEMENT_NODE){var b=this._items.indexOf(a);-1<b&&this._items.splice(b,1),this.intersection.unobserve(a)}return this}},{key:'reset',value:function(){var a,b=!0,c=!1;try{for(var d,e,f=this._items[Symbol.iterator]();!(b=(d=f.next()).done);b=!0)e=d.value,e.classList.remove(this.options.visibleClass)}catch(b){c=!0,a=b}finally{try{!b&&f.return&&f.return()}finally{if(c)throw a}}return this}},{key:'destroy',value:function(){return this.disconnect(),this}},{key:'items',get:function(){return this._items},set:function(a){Array.isArray(a)&&(this._items=a,this.connect())}}]),a}();b.default=g,a.exports=b['default']});