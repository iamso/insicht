/*!
 * insicht - version 0.7.0
 *
 * Made with ‚ù§ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2020 Steve Ottoz
 */
(function(a,b){if('function'==typeof define&&define.amd)define(['module','exports'],b);else if('undefined'!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.InSicht=c.exports}})(this,function(a,b){'use strict';function c(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var d=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},e=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={container:document.documentElement,selector:'.insicht',visibleClass:'sichtbar',stagger:100,threshold:0,autoRefresh:!1,autoReset:!1,autoRemove:!1,init:function(){},done:function(){}},g=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.options=d({},f,b),this.init()}return e(a,[{key:'init',value:function(){return this.intersection=new IntersectionObserver(this.onIntersection.bind(this),{threshold:this.options.threshold}),this.mutation=new MutationObserver(this.onMutation.bind(this)),this.refreshTimeout=null,this._items=[],this.connect(),this.refresh(),this}},{key:'refresh',value:function(){var a=this;return clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){a.items=[].slice.call(a.options.container.querySelectorAll(a.options.selector),0)},100),this}},{key:'order',value:function(c,a){return this._items.indexOf(c.target)-this._items.indexOf(a.target)}},{key:'connect',value:function(){var a=this;return this.disconnect(),this._items.forEach(function(b){a.options.init instanceof Function&&a.options.init.apply(a,[b,a]),a.intersection.observe(b)}),this.options.autoRefresh&&this.mutation.observe(this.options.container,{subtree:!0,attributes:!0,childList:!0}),this}},{key:'disconnect',value:function(){return this.intersection.disconnect(),this.mutation.disconnect(),this}},{key:'onIntersection',value:function(a){var b=0;for(var c in a=[].slice.call(a,0),a.sort(this.order.bind(this)),a){var d=a[c].target,e=a[c].isIntersecting;e&&!d.classList.contains(this.options.visibleClass)?(b=0===c?0:b+(+d.dataset.stagger||this.options.stagger),d.style.transitionDelay=b+'ms',d.classList.add(this.options.visibleClass),this.options.done instanceof Function&&this.options.done.apply(this,[d,this]),this.options.autoRemove&&this.remove(d)):!e&&this.options.autoReset&&d.classList.contains(this.options.visibleClass)&&(d.style.transitionDelay='',d.classList.remove(this.options.visibleClass))}}},{key:'onMutation',value:function(a){var b=this;a=[].slice.call(a,0),a.forEach(function(a){var c=!1;[].slice.call(a.addedNodes,0).forEach(function(a){a.nodeType===Node.ELEMENT_NODE&&(b.matches(a,b.options.selector)||a.querySelectorAll(b.options.selector).length)&&(c=!0)}),c&&b.refresh()})}},{key:'matches',value:function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)}},{key:'remove',value:function(a){if(!this.options.autoRefresh&&a&&a.nodeType===Node.ELEMENT_NODE){var b=this._items.indexOf(a);-1<b&&this._items.splice(b,1),this.intersection.unobserve(a)}return this}},{key:'reset',value:function(){var a=this;return this._items.forEach(function(b){b.classList.remove(a.options.visibleClass)}),this}},{key:'destroy',value:function(){return this.disconnect(),this}},{key:'items',get:function(){return this._items},set:function(a){Array.isArray(a)&&(this._items=a,this.connect())}}]),a}();b.default=g,a.exports=b['default']});